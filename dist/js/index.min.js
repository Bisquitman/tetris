!function(){"use strict";var o={d:function(e,t){for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o:function(o,e){return Object.prototype.hasOwnProperty.call(o,e)}};function e(o,e){if(!(o instanceof e))throw new TypeError("Cannot call a class as a function")}function t(o,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(o,n.key,n)}}function n(o,e,n){return e&&t(o.prototype,e),n&&t(o,n),Object.defineProperty(o,"prototype",{writable:!1}),o}function i(o,e,t){return e in o?Object.defineProperty(o,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):o[e]=t,o}o.d({},{cn:function(){return h},L0:function(){return l},ng:function(){return v}});var a={J:[[["o","o","o"],["J","J","J"],["o","o","J"]],[["o","J","o"],["o","J","o"],["J","J","o"]],[["J","o","o"],["J","J","J"],["o","o","o"]],[["o","J","J"],["o","J","o"],["o","J","o"]]],I:[[["o","o","o","o"],["I","I","I","I"],["o","o","o","o"],["o","o","o","o"]],[["o","o","I","o"],["o","o","I","o"],["o","o","I","o"],["o","o","I","o"]],[["o","o","o","o"],["o","o","o","o"],["I","I","I","I"],["o","o","o","o"]],[["o","I","o","o"],["o","I","o","o"],["o","I","o","o"],["o","I","o","o"]]],O:[[["O","O"],["O","O"]],[["O","O"],["O","O"]],[["O","O"],["O","O"]],[["O","O"],["O","O"]]],L:[[["o","o","o"],["L","L","L"],["L","o","o"]],[["L","L","o"],["o","L","o"],["o","L","o"]],[["o","o","L"],["L","L","L"],["o","o","o"]],[["o","L","o"],["o","L","o"],["o","L","L"]]],2:[[["o","o","o"],["2","2","o"],["o","2","2"]],[["o","2","o"],["2","2","o"],["2","o","o"]],[["2","2","o"],["o","2","2"],["o","o","o"]],[["o","o","2"],["o","2","2"],["o","2","o"]]],T:[[["o","o","o"],["T","T","T"],["o","T","o"]],[["o","T","o"],["T","T","o"],["o","T","o"]],[["o","T","o"],["T","T","T"],["o","o","o"]],[["o","T","o"],["o","T","T"],["o","T","o"]]],S:[[["o","o","o"],["o","S","S"],["S","S","o"]],[["S","o","o"],["S","S","o"],["o","S","o"]],[["o","S","S"],["S","S","o"],["o","o","o"]],[["o","S","o"],["o","S","S"],["o","o","S"]]]},r=function(){function o(){e(this,o),i(this,"score",0),i(this,"lines",0),i(this,"level",1),i(this,"record",localStorage.getItem("tetris-record")||0),i(this,"points",[0,100,300,700,1500]),i(this,"gameOver",!1),i(this,"area",[["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"],["o","o","o","o","o","o","o","o","o","o"]]),i(this,"activeTetramino",this.createTetramino()),i(this,"nextTetramino",this.createTetramino())}return n(o,[{key:"createTetramino",value:function(){var o=Object.keys(a),e=o[Math.floor(Math.random()*o.length)],t=a[e],n=Math.floor(Math.random()*t.length);return{block:t[n],rotationIndex:n,rotation:t,x:3,y:0}}},{key:"changeTetramino",value:function(){this.activeTetramino=this.nextTetramino,this.nextTetramino=this.createTetramino()}},{key:"moveLeft",value:function(){this.checkOutPosition(this.activeTetramino.x-1,this.activeTetramino.y)&&(this.activeTetramino.x-=1)}},{key:"moveRight",value:function(){this.checkOutPosition(this.activeTetramino.x+1,this.activeTetramino.y)&&(this.activeTetramino.x+=1)}},{key:"moveDown",value:function(){this.gameOver||(this.checkOutPosition(this.activeTetramino.x,this.activeTetramino.y+1)?this.activeTetramino.y+=1:this.stopMove())}},{key:"rotateTetramino",value:function(){this.activeTetramino.rotationIndex=this.activeTetramino.rotationIndex<3?this.activeTetramino.rotationIndex+1:0,this.activeTetramino.block=this.activeTetramino.rotation[this.activeTetramino.rotationIndex],this.checkOutPosition(this.activeTetramino.x,this.activeTetramino.y)||(this.activeTetramino.rotationIndex=this.activeTetramino.rotationIndex>0?this.activeTetramino.rotationIndex-1:3,this.activeTetramino.block=this.activeTetramino.rotation[this.activeTetramino.rotationIndex])}},{key:"viewArea",get:function(){for(var o=JSON.parse(JSON.stringify(this.area)),e=this.activeTetramino,t=e.x,n=e.y,i=e.block,a=0;a<i.length;a++)for(var r=i[a],c=0;c<r.length;c++)"o"!==r[c]&&(o[n+a][t+c]=i[a][c]);return o}},{key:"checkOutPosition",value:function(o,e){for(var t=this.activeTetramino.block,n=0;n<t.length;n++)for(var i=0;i<t[n].length;i++)if(!("o"===t[n][i]||this.area[e+n]&&this.area[e+n][o+i]&&"o"===this.area[e+n][o+i]))return!1;return!0}},{key:"stopMove",value:function(){for(var o=this.activeTetramino,e=o.x,t=o.y,n=o.block,i=0;i<n.length;i++)for(var a=n[i],r=0;r<a.length;r++)"o"!==a[r]&&(this.area[t+i][e+r]=n[i][r]);this.changeTetramino();var c=this.clearRow();this.calcScore(c),this.updatePanels(),this.gameOver=!this.checkOutPosition(this.activeTetramino.x,this.activeTetramino.y)}},{key:"clearRow",value:function(){for(var o=this,e=[],t=v-1;t>=0;t--){for(var n=0,i=0;i<l;i++)"o"!==this.area[t][i]&&(n+=1);if(!n)break;n===l&&e.unshift(t)}return e.forEach((function(e){o.area.splice(e,1),o.area.unshift(Array(l).fill("o"))})),e.length}},{key:"calcScore",value:function(o){this.score+=this.points[o],this.lines+=o,this.level=Math.floor(this.lines/10)+1,this.score>this.record&&(this.record=this.score,localStorage.setItem("tetris-record",this.score))}},{key:"createUpdatePanels",value:function(o,e){var t=this;o(this.lines,this.score,this.level,this.record),e(this.nextTetramino.block),this.updatePanels=function(){o(t.lines,t.score,t.level,t.record),e(t.nextTetramino.block)}}}]),o}(),c=function(){function o(t){e(this,o),i(this,"colors",{J:"#14274E",I:"#394867",O:"#9BA4B4",L:"#7A58FF",2:"#396EB0",T:"#DADDFC",S:"#3f484d"}),i(this,"canvas",document.createElement("canvas")),this.container=t,this.preview()}return n(o,[{key:"preview",value:function(){this.container.textContent="";var o=document.createElement("div");o.innerHTML='Press "Enter" <br>to start',o.style.cssText="\n      border: 3px solid black;\n      text-align: center;\n      font-family: sans-serif;\n      font-size: 200%;\n      font-weight: 900;\n      color: #FF376A;\n      padding: 50px;\n      grid-column: 1/3;\n    ",this.container.append(o)}},{key:"init",value:function(){this.container.textContent="",this.canvas.classList.add("game-area"),this.container.append(this.canvas),this.canvas.width=h*l,this.canvas.height=h*v}},{key:"createScoreBlock",value:function(){var o=document.createElement("div");o.style.cssText="\n      border: 1px solid #9BA4B4;\n      font-size: 18px;\n      padding: 20px;\n      grid-area: score;\n    ";var e=document.createElement("p"),t=document.createElement("p"),n=document.createElement("p"),i=document.createElement("p");return o.append(e,t,n,i),this.container.append(o),function(o,a,r,c){e.textContent="lines: ".concat(o),t.textContent="score: ".concat(a),n.textContent="level: ".concat(r),i.textContent="record: ".concat(c)}}},{key:"createNextTetraminoBlock",value:function(){var o=this,e=document.createElement("div");e.style.cssText="\n      width: ".concat(4*h,"px;\n      height: ").concat(4*h,"px;\n      border: 1px solid #9BA4B4;\n      padding: 10px;\n      grid-area: next;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    ");var t=document.createElement("canvas"),n=t.getContext("2d");return e.append(t),this.container.append(e),function(e){t.width=h*e.length,t.height=h*e.length,n.clearRect(0,0,t.width,t.height);for(var i=0;i<e.length;i++)for(var a=e[i],r=0;r<a.length;r++){var c=a[r];"o"!==c&&(n.fillStyle=o.colors[c],n.strokeStyle="white",n.fillRect(r*h,i*h,h,h),n.strokeRect(r*h,i*h,h,h))}}}},{key:"showArea",value:function(o){var e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height);for(var t=0;t<o.length;t++)for(var n=o[t],i=0;i<n.length;i++){var a=n[i];"o"!==a&&(e.fillStyle=this.colors[a],e.strokeStyle="white",e.fillRect(i*h,t*h,h,h),e.strokeRect(i*h,t*h,h,h))}}}]),o}(),s=function(){function o(t,n){e(this,o),this.game=t,this.view=n}return n(o,[{key:"init",value:function(o){var e=this;window.addEventListener("keydown",(function(t){o.includes(t.code)&&(e.view.init(),e.start())}))}},{key:"start",value:function(){var o=this;this.view.showArea(this.game.viewArea),this.game.createUpdatePanels(this.view.createScoreBlock(),this.view.createNextTetraminoBlock());!function e(){var t=1100-100*o.game.level;o.game.gameOver||setTimeout((function(){o.game.moveDown(),o.view.showArea(o.game.viewArea),e()}),t>100?t:100)}(),window.addEventListener("keydown",(function(e){switch(e.code){case"ArrowLeft":case"KeyA":o.game.moveLeft(),o.view.showArea(o.game.viewArea);break;case"ArrowRight":case"KeyD":o.game.moveRight(),o.view.showArea(o.game.viewArea);break;case"ArrowDown":case"KeyS":o.game.moveDown(),o.view.showArea(o.game.viewArea);break;case"ArrowUp":case"KeyW":o.game.rotateTetramino(),o.view.showArea(o.game.viewArea)}}))}}]),o}(),h=25,l=10,v=2*l;new s(new r,new c(document.querySelector(".container"))).init(["Enter","Space"])}();